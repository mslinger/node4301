<%- include('./includes/head.ejs') %>
</head>
<body>
    <%- include('./includes/nav.ejs') %>
    <main>
    <div class="container">
        <div class="row">
            <h2>Query One</h2>
            <p>This query gives a visual comparison of how critics rated a movie in comparison to that of the consumer. This will be done in a yearly fashion, where the end user can select the span of years to view. The citics will include the critical review scores from Rotten Tomatoes, MetaCritic, and IMDB. The Consumer reviews will include those completed by reviewers on Rotten Tomatoes, MetaCritic, and IMDB.</p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col m6 offset-m3">
            <div class="card grey lighten-4 z-depth-2">
                <div class="card-content pink-text darken-3">
                    <span class="card-title">Number of Films By Genre Per Year</span>
                    <form action="/queryone" method="POST">
                    <div class="input field">
                        <label for="year">Year</label>
                        <input class="validate" type="number" name="year" min="1970" max="2020">                        
                    </div>
                    <div>
                    <label style="margin: 5px;">
                        <input type="checkbox" class="filled-in" name="descending"/>
                        <span>Descending</span>
                    </label>
                    <label style="margin: 5px">
                        <input type="checkbox" class="filled-in" name="ascending"/>
                        <span>Ascending</span>
                    </label>
                    </div>
                    <br>
                    <button class="btn purple darken-1" type="submit">Submit</button>
                    </form>                    
                </div>
            </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">            
            <canvas id="myChart" width="900" height="500"></canvas>
            <script>
                let result_array = '<%- JSON.stringify(data)%>';
                result_array = JSON.parse(result_array);

                let data_labels = [];
                let data_values = [];

                for(let i=0; i < result_array.length; i++){

                    if(result_array[i][0] != null && result_array[i][1] != 0){
                        data_labels.push(result_array[i][0]);
                        data_values.push(result_array[i][1]);
                    }
                }

                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data_labels,
                        datasets: [{
                            label: 'Number of Films',
                            data: data_values,
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.65)',
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y:{
                                beginAtZero: true
                            }
                        },
                        responsive: true
                    }
                });
            </script>
        </div>
    </div>

<%- include('./includes/end.ejs') %>