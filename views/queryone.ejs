<%- include('./includes/head.ejs') %>
<script>
//For Multiple Select
    document.addEventListener('DOMContentLoaded', function() {
        var instances = M.AutoInit();
});</script>
</head>
<body>
    <%- include('./includes/nav.ejs') %>
    <main>
    <div class="container">
        <div class="row">
            <h2>Query One</h2>
            <p>This query gives a visual comparison of how critics rated a movie in comparison to that of the consumer. This will be done in a yearly fashion, where the end user can select the span of years to view. The citics will include the critical review scores from Rotten Tomatoes, MetaCritic, and IMDB. The Consumer reviews will include those completed by reviewers on Rotten Tomatoes, MetaCritic, and IMDB.</p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col m6 offset-m3">
            <div class="card grey lighten-4 z-depth-2">
                <div class="card-content pink-text darken-3">
                    <span class="card-title">Number of Films By Genre Per Year</span>
                    <form action="/queryone" method="POST">
                    <div class="input field">
                        <label for="year">Year</label>
                        <input class="validate" type="number" name="year" min="1970" max="2020" required>                        
                    </div>
                    <div>
                    <label style="margin: 5px;">
                        <input type="checkbox" class="filled-in" name="descending"/>
                        <span>Descending</span>
                    </label>
                    <label style="margin: 5px">
                        <input type="checkbox" class="filled-in" name="ascending"/>
                        <span>Ascending</span>
                    </label>
                    </div>
                    <br>
                    <button class="btn purple darken-1" type="submit">Submit</button>
                    </form>                    
                </div>
            </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <% if((typeof(first_query) == "undefined") ? '' : first_query) { %>           
            <canvas id="barChart" width="900" height="500"></canvas>
            
            <script>
                let status = '<%= (typeof(first_query) == "undefined") ? '' : first_query %>';

                let result_array;
                let data_labels = [];
                let data_values = [];

                console.log(status);
                if(status == 'true'){
                    result_array = '<%- JSON.stringify(data)%>'
                    result_array = JSON.parse(result_array);
                }

                console.log(result_array);

    
                for(let i=0; i < result_array.length; i++){
    
                    if(result_array[i][0] != null && result_array[i][1] != 0){
                        data_labels.push(result_array[i][0]);
                        data_values.push(result_array[i][1]);
                    }
                }
    
                const ctx = document.getElementById('barChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data_labels,
                        datasets: [{
                            label: 'Number of Films',
                            data: data_values,
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.65)',
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y:{
                                beginAtZero: true
                            }
                        },
                        responsive: true
                    }
                });
            </script>
            <% } %>            
        </div>
    </div>
    <br>
    <br>    
    <div class="container">
        <div class="row">
            <div class="col m6 offset-m3">
            <div class="card grey lighten-4 z-depth-2">
                <div class="card-content pink-text darken-3">
                    <span class="card-title">Percentage of Films By Genre Per Year</span>
                    <form action="/queryonep2" method="POST">
                    <div class="input field">
                        <label for="year">From Year</label>
                        <input class="validate" type="number" name="fromyear" min="1970" max="2020" required>                        
                    
                    <div class="input field">
                        <label for="year">To Year</label>
                        <input class="validate" type="number" name="toyear" min="1970" max="2020" required>                        
                    </div>
                    <select multiple id="option-select" name="genres"required>
                        <option value="" disabled selected>Choose your option</option>
                        <option value="Action">Action</option>
                        <option value="Adult">Adult</option>
                        <option value="Adventure">Adventure</option>
                        <option value="Animation">Animation</option>
                        <option value="Biography">Biography</option>
                        <option value="Comedy">Comedy</option>
                        <option value="Crime">Crime</option>
                        <option value="Documentary">Documentary</option>
                        <option value="Drama">Drama</option>
                        <option value="Family">Family</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Game-Show">Game-Show</option>
                        <option value="History">History</option>
                        <option value="Horror">Horror</option>
                        <option value="Music">Music</option>
                        <option value="Musical">Musical</option>
                        <option value="Mystery">Mystery</option>
                        <option value="News">News</option>
                        <option value="Reality-TV">Reality-TV</option>
                        <option value="Romance">Romance</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Short">Short</option>
                        <option value="Sport">Sport</option>
                        <option value="Talk-Show">Talk-Show</option>
                        <option value="Thriller">Thriller</option>
                        <option value="War">War</option>
                        <option value="Western">Western</option>
                     </select>                     
                     </div>
                    <button class="btn purple darken-1" type="submit">Submit</button>
                    </form>                    
                </div>
            </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col l12">
                <% if((typeof(second_query) == "undefined") ? '' : second_query) { %>             
                <canvas id="line-chart" width="900" height="500"></canvas>
            </div>
        </div>
    </div>
    <script>
    
            //Second Graph Information
    let dataGenre1 = {
    label: "",
    data: [],
    lineTension: 0,
    fill: false,
    borderColor: 'rgba(54, 162, 235, 1)'
    };    

    let dataGenre2 = {
    label:"",
    data: [],
    lineTension: 0,
    fill: false,
    borderColor: 'rgba(255, 99, 132, 1)'
    };

    let dataGenre3 = {
    label:"",
    data: [],
    lineTension: 0,
    fill: false,
    borderColor: 'rgba(38, 166, 154, 1)'
    };

    let dataGenre4 = {
    label:"",
    data: [],
    lineTension: 0,
    fill: false,
    borderColor: 'rgba(142, 36, 170, 1)'
    };

    let dataGenre5 = {
    label:"",
    data: [],
    lineTension: 0,
    fill: false,
    borderColor: 'rgba(46, 42, 93, 1)'
    };

    

            let status2 = '<%= (typeof(second_query) == "undefined") ? '' : second_query %>';
            
            let result_array2;
            let genres_array;
            let years_array;
            

            if(status2 == 'true'){
                result_array2 = '<%- JSON.stringify(data)%>'
                result_array2 = JSON.parse(result_array2);
                genres_array = '<%- JSON.stringify(genres)%>'
                genres_array = JSON.parse(genres_array);
                years_array = '<%- JSON.stringify(years)%>'
                years_array = JSON.parse(years_array);
            }            

            for( const genre of genres_array){

                if(dataGenre1.label == ""){
                    dataGenre1.label = genre;
                }
                else if(dataGenre2.label == ""){
                    dataGenre2.label = genre;
                }
                else if(dataGenre3.label == ""){
                    dataGenre3.label = genre;
                }
                else if(dataGenre4.label == ""){
                    dataGenre4.label = genre;
                }
                else if(dataGenre5.label == ""){
                    dataGenre5.label = genre;
                }
            }
            
            let genreData = {
    labels: years_array,
    datasets: []
    };
    
            let data_Genres = [dataGenre1, dataGenre2, dataGenre3, dataGenre4, dataGenre5];
            
            for(let i=0; i < genres_array.length; i++){

                console.log(years_array.length);
                for(let j=0; j < years_array.length; j++){ 
                    
                    multiple = years_array.length;
                    data_Genres[i].data.push(result_array2[(i*multiple)+j][2]);
                }
            }

            for(let i=0; i < genres_array.length; i++){
                genreData.datasets.push(data_Genres[i]);
            }
       
    console.log(data_Genres[1].data);
    
    
    let chartOptions = {
        legend: {
            display: true,
            position: 'top',
            labels: {
                boxWidth: 80,
            }
        },
        scales: {
        }
    };

    let genreCanvas = document.getElementById("line-chart");
    let lineChart = new Chart(genreCanvas, {
        type: 'line',
        data: genreData,
        options: chartOptions
    }); 
    </script>
    <% } %>
    <br>  
<%- include('./includes/end.ejs') %>